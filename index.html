<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBQdlikBbxE0_U_meQ2PiNas3dlt6-OvPA",
  authDomain: "irn-chat.firebaseapp.com",
  projectId: "irn-chat",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// فرض می‌کنیم uid کاربر جاری اینه
const currentUser = { uid: "USER_UID_HERE" };

const chatBox = document.getElementById("chatBox");

// ارسال پیام
async function sendMessage(text){
  if(!text) return;
  await addDoc(collection(db,"messages"),{
    text: text,
    senderId: currentUser.uid,
    receiverId: null, // عمومی
    time: Date.now()
  });
}

// دریافت پیام‌ها و نمایش با دکمه حذف
const q = query(collection(db,"messages"), orderBy("time"));
onSnapshot(q, snap => {
  chatBox.innerHTML = "";
  snap.forEach(docSnap => {
    const d = docSnap.data();
    const div = document.createElement("div");
    div.innerHTML = `<b>${d.senderId}</b>: ${d.text}`;
    
    // اگر پیام برای کاربر جاری است، دکمه حذف اضافه شود
    if(d.senderId === currentUser.uid){
      const delBtn = document.createElement("button");
      delBtn.innerText = "❌ حذف";
      delBtn.onclick = async () => {
        await deleteDoc(doc(db,"messages",docSnap.id));
      };
      div.appendChild(delBtn);
    }

    chatBox.appendChild(div);
  });
});
               </script>
